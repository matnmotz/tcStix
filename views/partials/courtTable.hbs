<div class="w-full max-w-[93%] mx-auto overflow-x-auto py-5">
  <!-- AUSWAHLEN -->
  <div class="flex w-max lg:w-full mx-auto">
    <div class="lg:flex">
      <div class='flex items-center mr-4'>
        <div class="w-[20px] h-[20px] mr-3" style="background-color: yellow;" id="colorReservation"></div>
        <p>reserviert</p>
      </div>
      <div class='flex items-center mr-4'>
        <div class="w-[20px] h-[20px] mr-3" style="background-color: yellow;" id="colorClosure"></div>
        <p>gesperrt</p>
      </div>
      <div class='flex items-center mr-4'>
        <div class="w-[20px] h-[20px] mr-3" style="background-color: yellow;" id="colorChampionship"></div>
        <p>Meisterschaft</p>
      </div>
    </div>
    <div class="w-max flex mx-auto lg:ml-auto lg:mr-0 py-3">
      <!-- KW auswählen -->
      <div class="w-max text-white px-3" id="choose-kw-drp">
        <div id="kw-button" class="bg-gray-900 flex items-center px-5 py-3 cursor-pointer">
          <span id="kw-button-text"></span>
          <img src="/media/svg/arrowhead_down.svg" class="h-[30px]" />
        </div>
        <div id="kw-choose" class="bg-gray-900 border-t border-white px-5 py-3 hidden">
        </div>
      </div>
      <!-- Ansicht auswählen -->
      <div class="w-max text-white pl-3">
        <div id="view-button" class="bg-gray-900 flex items-center px-5 py-3 cursor-pointer">
          <span id="view-button-text"></span>
          <img src="/media/svg/arrowhead_down.svg" class="h-[30px]" />
        </div>
        <div id="view-choose" class="bg-gray-900 border-t border-white px-5 py-3 hidden">
        </div>
      </div>
    </div>
  </div>
  <div>
  <!-- WEEK VIEW -->
    <table class="w-full border-collapse border border-gray-300 text-center text-sm overflow-x-auto" id="weekTable">
      <thead>
        <!-- Zeile 1: Wochentage -->
        <tr class="bg-gray-100">
          <th rowspan="3" class="border border-gray-300 p-2 w-20">Zeit</th>
          <th colspan="2" class="border border-gray-300 p-2">
            <span class="hidden xl:inline">Montag</span>
            <span class="inline xl:hidden">Mo</span>
          </th>
          <th colspan="2" class="border border-gray-300 p-2">
            <span class="hidden xl:inline">Dienstag</span>
            <span class="inline xl:hidden">Di</span>
          </th>
          <th colspan="2" class="border border-gray-300 p-2">
            <span class="hidden xl:inline">Mittwoch</span>
            <span class="inline xl:hidden">Mi</span>
          </th>
          <th colspan="2" class="border border-gray-300 p-2">
            <span class="hidden xl:inline">Donnerstag</span>
            <span class="inline xl:hidden">Do</span>
          </th>
          <th colspan="2" class="border border-gray-300 p-2">
            <span class="hidden xl:inline">Freitag</span>
            <span class="inline xl:hidden">Fr</span>
          </th>
          <th colspan="2" class="border border-gray-300 p-2">
            <span class="hidden xl:inline">Samstag</span>
            <span class="inline xl:hidden">Sa</span>
          </th>
          <th colspan="2" class="border border-gray-300 p-2">
            <span class="hidden xl:inline">Sonntag</span>
            <span class="inline xl:hidden">So</span>
          </th>
        </tr>

        <!-- Zeile 2: Datum -->
        <tr class="bg-gray-100 dates-row">
          <th colspan="2" class="border border-gray-300 p-2"></th>
          <th colspan="2" class="border border-gray-300 p-2"></th>
          <th colspan="2" class="border border-gray-300 p-2"></th>
          <th colspan="2" class="border border-gray-300 p-2"></th>
          <th colspan="2" class="border border-gray-300 p-2"></th>
          <th colspan="2" class="border border-gray-300 p-2"></th>
          <th colspan="2" class="border border-gray-300 p-2"></th>
        </tr>

        <!-- Zeile 3: Platz 1 / Platz 2 -->
        <tr class="bg-gray-100">
          <th class="border border-gray-300 p-2">Platz 1</th>
          <th class="border border-gray-300 p-2">Platz 2</th>
          <th class="border border-gray-300 p-2">Platz 1</th>
          <th class="border border-gray-300 p-2">Platz 2</th>
          <th class="border border-gray-300 p-2">Platz 1</th>
          <th class="border border-gray-300 p-2">Platz 2</th>
          <th class="border border-gray-300 p-2">Platz 1</th>
          <th class="border border-gray-300 p-2">Platz 2</th>
          <th class="border border-gray-300 p-2">Platz 1</th>
          <th class="border border-gray-300 p-2">Platz 2</th>
          <th class="border border-gray-300 p-2">Platz 1</th>
          <th class="border border-gray-300 p-2">Platz 2</th>
          <th class="border border-gray-300 p-2">Platz 1</th>
          <th class="border border-gray-300 p-2">Platz 2</th>
        </tr>
      </thead>

      <tbody id="timeTableBody"></tbody>
    </table>
  </div>
  <!-- DAY VIEW -->
  <div id="dayTable" class="hidden">
    <table class="w-full border-collapse border border-gray-300 text-center text-sm w-max mx-auto">
      <thead>
        <tr class="bg-gray-100">
          <th rowspan="3" class="border border-gray-300 p-2 w-20">Zeit</th>
          <th colspan="2" class="border border-gray-300 p-2">
            <span id="dayView-weekday">Montag</span>
          </th>
        </tr>

        <tr class="bg-gray-100 dates-row">
          <th colspan="2" id="dayView-date" class="border border-gray-300 p-2"><input type="date" id="dateInput"/></th>
        </tr>

        <tr class="bg-gray-100">
          <th class="border border-gray-300 p-2 px-5">Platz 1</th>
          <th class="border border-gray-300 p-2 px-5">Platz 2</th>
        </tr>
      </thead>

      <tbody id="dayTimeTableBody"></tbody>
    </table>
  </div>
</div>

<script>
  setColors();
  fillKWToDropdown();
  fillViewDropdown();
  createWeekTable();
  createDayTable();
  fillData(getKW());
  fillDataDayView(new Date());
  // SET right table for VP
  const mediaQuery = window.matchMedia("(max-width: 1024px)");

  function handleViewportChange(e) {
    const kwDrp = document.getElementById('choose-kw-drp');
    if (e.matches) {
      dayView();
      kwDrp.classList.remove('show');
      kwDrp.classList.add('hidden');
    } else {
      weekView();
      kwDrp.classList.remove('hidden');
      kwDrp.classList.add('show');
    }
  }
  handleViewportChange(mediaQuery);
  // Auf Änderungen reagieren
  mediaQuery.addEventListener("change", handleViewportChange);

  function getMondayOfWeek(week, year = new Date().getFullYear()) {
    const jan4 = new Date(year, 0, 4);
    const dayOfWeek = jan4.getDay() || 7;
    const firstMonday = new Date(jan4);
    firstMonday.setDate(jan4.getDate() - dayOfWeek + 1);

    const monday = new Date(firstMonday);
    monday.setDate(firstMonday.getDate() + (week - 1) * 7);

    return monday;
  }
  // WEEK TABLE
  function createWeekTable(){
    const heute = new Date();
    const day = heute.getDay(); // Sonntag=0
    const diff = day === 0 ? -6 : 1 - day; // Montag der aktuellen Woche
    const ersterTag = (getMondayOfWeek(getKW()));

    const dateCells = document.querySelectorAll(".dates-row th");
    for (let i = 0; i < 7; i++) {
      const tag = new Date(ersterTag);
      tag.setDate(ersterTag.getDate() + i);
      const datum = tag.toLocaleDateString("de-DE", { day: "2-digit", month: "2-digit" });

      // Jede Zelle hat colspan=2 → beide Spalten denselben Wert setzen
      dateCells[i].textContent = datum;
      const nextCell = dateCells[i].nextElementSibling;
      if (nextCell) nextCell.textContent = datum;
    }

    // --- Zeitspalten generieren (06–22 Uhr, je 2 Zeilen pro Stunde) ---
    const tbody = document.getElementById("timeTableBody");

    for (let stunde = 7; stunde <= 22; stunde++) {
      // Erste Zeile der Stunde
      const tr1 = document.createElement("tr");
      const tr2 = document.createElement("tr");

      // Zeit-Zelle links mit rowspan=2
      let zeitCell = document.createElement("td");
      zeitCell.rowSpan = "2";
      zeitCell.className = "border-r border-l border-t border-gray-300 p-2 font-medium bg-gray-50";
      zeitCell.textContent = `${String(stunde-1).padStart(2, "0")}:00`;
      tr1.appendChild(zeitCell);

      // 14 Platz-Zellen für Platz 1 & 2 für 7 Tage
      for (let i = 0; i < 14; i++) {
        let td = document.createElement("td");
        td.className = "border border-gray-300 p-2 h-6";
        tr1.appendChild(td);
        td = document.createElement("td");
        td.className = "border border-gray-300 p-2 h-6";
        tr2.appendChild(td);
      }
      tbody.appendChild(tr1);
      tbody.appendChild(tr2);
    }
  }

  function recreateTbody(){
    const tbody = document.getElementById("timeTableBody");

    for (let stunde = 7; stunde <= 22; stunde++) {
      // Erste Zeile der Stunde
      const tr1 = document.createElement("tr");
      const tr2 = document.createElement("tr");

      // Zeit-Zelle links mit rowspan=2
      let zeitCell = document.createElement("td");
      zeitCell.rowSpan = "2";
      zeitCell.className = "border-r border-l border-t border-gray-300 p-2 font-medium bg-gray-50";
      zeitCell.textContent = `${String(stunde-1).padStart(2, "0")}:00`;
      tr1.appendChild(zeitCell);

      // 14 Platz-Zellen für Platz 1 & 2 für 7 Tage
      for (let i = 0; i < 14; i++) {
        let td = document.createElement("td");
        td.className = "border border-gray-300 p-2 h-6";
        tr1.appendChild(td);
        td = document.createElement("td");
        td.className = "border border-gray-300 p-2 h-6";
        tr2.appendChild(td);
      }
      tbody.appendChild(tr1);
      tbody.appendChild(tr2);
    }
  }

  function changeDatesAtWeekTable(week){
    const ersterTag = getMondayOfWeek(week);
    const dateCells = document.querySelectorAll(".dates-row th");
    for (let i = 0; i < 7; i++) {
      const tag = new Date(ersterTag);
      tag.setDate(ersterTag.getDate() + i);
      const datum = tag.toLocaleDateString("de-DE", { day: "2-digit", month: "2-digit" });

      // Jede Zelle hat colspan=2 → beide Spalten denselben Wert setzen
      dateCells[i].textContent = datum;
      const nextCell = dateCells[i].nextElementSibling;
      if (nextCell) nextCell.textContent = datum;
    }
  }
  
  function showBookingsAtWeekTable(week){
    
  }
  // DAY TABLE
  function createDayTable(){
    setTodaysValues()
    setMinAndMaxForDateInput();
    setDateAndWeekdayFromInput();
    createRows();
  }
  
  function setMinAndMaxForDateInput(){
    const input = document.getElementById('dateInput');
    const today = new Date();

    const dayOfWeek = today.getDay();
    const diffToMonday = (dayOfWeek === 0 ? -6 : 1) - dayOfWeek;
    const mondayThisWeek = new Date(today);
    mondayThisWeek.setDate(today.getDate() + diffToMonday);

    const endDate = new Date(mondayThisWeek);
    endDate.setDate(mondayThisWeek.getDate() + 20);

    const formatDate = (date) => date.toISOString().split('T')[0];

    input.min = formatDate(mondayThisWeek);
    input.max = formatDate(endDate);
  }
  
  function setDateAndWeekdayFromInput(){
    const weekdays = ["Sonntag","Montag", "Dienstag","Mittwoch","Donnerstag","Freitag","Samstag"];
    const input = document.getElementById('dateInput');
    input.addEventListener('change', (event) => {
      const date = new Date(input.value);
      document.getElementById('dayView-weekday').innerText = weekdays[date.getDay()];
      clearTbodyDayView();
      recreateDayView();
      fillDataDayView(date);
    })
  }
  
  function setTodaysValues(){
    const weekdays = ["Sonntag","Montag", "Dienstag","Mittwoch","Donnerstag","Freitag","Samstag"];
    const today = new Date();
    const y = today.getFullYear();
    const m = String(today.getMonth() + 1).padStart(2, '0');
    const d = String(today.getDate()).padStart(2, '0');
    const formatted = `${y}-${m}-${d}`;
    document.getElementById('dateInput').value = formatted;
    document.getElementById('dayView-weekday').innerText = weekdays[today.getDay()];
  }

  function createRows(){
    const tbody = document.getElementById('dayTimeTableBody');
    for (let stunde = 7; stunde <= 22; stunde++) {
      // Erste Zeile der Stunde
      const tr1 = document.createElement("tr");
      tr1.classList.add('h-6');

      // Zeit-Zelle links mit rowspan=2
      let zeitCell = document.createElement("td");
      zeitCell.className = "border-r border-l border-t border-gray-300 p-2 font-medium bg-gray-50";
      zeitCell.textContent = `${String(stunde-1).padStart(2, "0")}:00`;
      zeitCell.rowSpan = 2;
      tr1.appendChild(zeitCell);

      // 14 Platz-Zellen für Platz 1 & 2 für 7 Tage
      const tr2 = document.createElement('tr');
      tr2.classList.add('h-6');
      for (let i = 0; i < 2; i++) {
        let td = document.createElement("td");
        td.className = "border border-gray-300 p-2 h-6";
        tr1.appendChild(td);
        td = document.createElement("td");
        td.className = "border border-gray-300 p-2 h-6";
        tr2.appendChild(td);
      }
      tbody.appendChild(tr1);
      tbody.appendChild(tr2);
    }
  }

  //DROPDOWN VIEW
  function fillViewDropdown(){
    const views = ["Wochenansicht","Tagesansicht"];
    const cont = document.getElementById('view-choose');
    const isBelowLg = window.matchMedia('(max-width: 1023px)').matches;
    const btnTxt = document.getElementById('view-button-text');
    btnTxt.innerText = views[0];
    for(let i = 0; i < views.length; i++){
      let elem = document.createElement('div');
      elem.innerText = views[i];
      elem.className = 'cursor-pointer';
      cont.appendChild(elem);
    }
    elViewBtn();
    elViewChoose();
  }
 
  function dayView(){
    const btnText = document.getElementById('view-button-text');
    btnText.innerText = "Tagesansicht";
    //Tagesansicht show & Wochenansicht hidden
    document.getElementById('dayTable').classList.remove('hidden');
    document.getElementById('dayTable').classList.add('show');
    document.getElementById('weekTable').classList.remove('show');
    document.getElementById('weekTable').classList.add('hidden');
  }
 
  function weekView(){
    const btnText = document.getElementById('view-button-text');
    btnText.innerText = "Wochenansicht";
    //Tagesansicht hidden & Wochenansicht show
    document.getElementById('dayTable').classList.remove('show');
    document.getElementById('dayTable').classList.add('hidden');
    document.getElementById('weekTable').classList.remove('hidden');
    document.getElementById('weekTable').classList.add('show');
  }
  
  function elViewBtn(){
    const btn = document.getElementById('view-button');
    const dropdown = document.getElementById('view-choose');
    btn.addEventListener('click', (event) => {
      if(dropdown.classList.contains('hidden')){
        dropdown.classList.remove('hidden');
        dropdown.classList.add('show');
      }else{
        dropdown.classList.remove('show');
        dropdown.classList.add('hidden');
      }
    });
  }
  
  function elViewChoose(){
    const childs = document.getElementById('view-choose').children;
    const cont = document.getElementById('view-choose');
    const kwDrp = document.getElementById('choose-kw-drp');
    for(let i = 0; i < childs.length; i++){
      childs[i].addEventListener('click', (event) => {
        const txt = event.target.innerText;
        if(txt == "Tagesansicht"){
          dayView();
          kwDrp.classList.remove('show');
          kwDrp.classList.add('hidden');
        }else if(txt == "Wochenansicht"){
          weekView();
          kwDrp.classList.remove('hidden');
          kwDrp.classList.add('show');
        }
        cont.classList.remove('show');
        cont.classList.add('hidden');
      });
    }
  }

  // DROPDOWN WEEK
  function elKwBtn(){
    const elem = document.getElementById('kw-button');
    const drpdwn = document.getElementById('kw-choose');
    elem.addEventListener('click', (event) => {
      if(drpdwn.classList.contains('hidden')){
        drpdwn.classList.remove('hidden');
        drpdwn.classList.add('show');
      }else{
        drpdwn.classList.remove('show');
        drpdwn.classList.add('hidden');
      }
    });
  }
  
  async function elKwChoose(){
    const elems = document.getElementById('kw-choose').children;
    const btn = document.getElementById('kw-button-text');
    for(let i = 0; i < elems.length; i++){
      elems[i].addEventListener('click', async(event) => {
        document.getElementById('kw-choose').classList.remove('show');
        document.getElementById('kw-choose').classList.add('hidden');
        btn.innerHTML = event.target.innerHTML;
        changeDatesAtWeekTable(parseInt(event.target.innerHTML.replace("KW", "").trim()));
        await clearTbody();
        recreateTbody();
        await fillData(event.target.innerHTML.replace("KW", "").trim());
      });
    }
  }
 
  function fillKWToDropdown(){
    const kw = getKW();
    document.getElementById('kw-button-text').innerHTML = "KW " + kw ;
    const cont = document.getElementById('kw-choose');
    for(let i = 0; i < 3; i++){
      let elem = document.createElement('div');
      elem.innerHTML = "KW " + (kw + i);
      elem.className = "cursor-pointer";
      cont.appendChild(elem);
    }
    elKwBtn();
    elKwChoose();
  }
  
  function getKW(datum = new Date()) {
    const d = new Date(Date.UTC(datum.getFullYear(), datum.getMonth(), datum.getDate()));
    const tagNum = (d.getUTCDay() + 6) % 7;
    d.setUTCDate(d.getUTCDate() - tagNum + 3);
    const ersterDonnerstag = new Date(Date.UTC(d.getUTCFullYear(), 0, 4));
    const diff = (d - ersterDonnerstag) / (7 * 24 * 3600 * 1000);
    return 2 + Math.floor(diff);
  }

function fillData(kw) {
    const bookingTypes = {{{json @root.bookingTypes}}};
    const bookings = {{{json bookingsForTable}}};
    const showNames = {{{json showNames}}};
    const tr = document.getElementById('timeTableBody').children;
    const { monday: startdate, sunday: enddate } = getMondayAndSundayOfKW(kw);

    for (let i = 0; i < bookings.length; i++) {
        const bookingDate = new Date(bookings[i].date.split("T")[0]);
        if (bookingDate < startdate || bookingDate > enddate) continue;

        const [startHH, startMM] = bookings[i].starttime.split(":").map(Number);
        const [endHH, endMM] = bookings[i].endtime.split(":").map(Number);
        const weekday = getWeekdayFromDate(bookings[i].date);

        let hexCode = "#000000";
        for (let j = 0; j < bookingTypes.length; j++) {
            if (bookingTypes[j].title === bookings[i].booking_type) {
                hexCode = bookingTypes[j].hexCode;
                break;
            }
        }

        let y = (startHH - 6) * 2 + (startMM === 30 ? 1 : 0);
        const oldY = y;
        let baseCol = (bookings[i].courtCourtID === 1 || bookings[i].courtCourtID === "1") ? 0 : 1;
        
        let hh = startHH;
        let mm = startMM;
        let currentY = y;

        while (hh * 60 + mm < endHH * 60 + endMM) {
            const row = tr[currentY];
            if (!row) break;

            let hasTimeCell = (currentY % 2 === 0);
            let colIndexInRow = (weekday * 2) + baseCol + (hasTimeCell ? 1 : 0);

            if (currentY !== oldY) {
                if (row.cells[colIndexInRow]) {
                    row.cells[colIndexInRow].style.display = 'none';
                }
            }

            if (mm === 30) { hh++; mm = 0; } else { mm = 30; }
            currentY++;
        }

        const firstRow = tr[oldY];
        let hasTimeCellStart = (oldY % 2 === 0);
        let finalColIndex = (weekday * 2) + baseCol + (hasTimeCellStart ? 1 : 0);
        
        const firstCell = firstRow.cells[finalColIndex];
        if (firstCell) {
            firstCell.style.backgroundColor = hexCode;
            firstCell.style.border = "1px solid #d1d5db";
            firstCell.rowSpan = currentY - oldY;

            if (bookings[i].booking_type == 'reservation' && showNames) {
                firstCell.classList.add(...'break-words', 'truncate', 'text-xs');
                let name = bookings[i].lastname.length <= 5 ? 
                           bookings[i].lastname : 
                           bookings[i].lastname.slice(0, 5) + ".";
                firstCell.innerText = name + "\n " + bookings[i].firstname.slice(0, 1) + ".";
            }
        }
    }
}

function fillDataDayView(d) {
    const rows = document.getElementById('dayTimeTableBody').children;
    const date = new Date(d);
    const bookingTypes = {{{json bookingTypes}}};
    const bookings = {{{json bookingsForTable}}};
    const showNames = {{{json showNames}}};

    for (let i = 0; i < bookings.length; i++) {
        const bDate = new Date(bookings[i].date.split("T")[0]);
        if (bDate.toDateString() !== date.toDateString()) continue;

        const [startHH, startMM] = bookings[i].starttime.split(":").map(Number);
        const [endHH, endMM] = bookings[i].endtime.split(":").map(Number);

        let y = (startHH - 6) * 2 + (startMM === 30 ? 1 : 0);
        const startY = y;
        const courtIdx = (bookings[i].courtCourtID === 1 || bookings[i].courtCourtID === "1") ? 1 : 2;

        let hexCode = "#000000";
        for (let j = 0; j < bookingTypes.length; j++) {
            if (bookingTypes[j].title === bookings[i].booking_type) {
                hexCode = bookingTypes[j].hexCode;
                break;
            }
        }

        let hh = startHH;
        let mm = startMM;
        let currentY = y;

        while (hh * 60 + mm < endHH * 60 + endMM) {
            const row = rows[currentY];
            if (currentY !== startY && row) {
                let hasTimeCell = (currentY % 2 === 0);
                let actualCol = hasTimeCell ? courtIdx : courtIdx - 1;
                if (row.cells[actualCol]) {
                    row.cells[actualCol].style.display = 'none';
                }
            }
            if (mm === 30) { hh++; mm = 0; } else { mm = 30; }
            currentY++;
        }

        const firstRow = rows[startY];
        let hasTimeCellStart = (startY % 2 === 0);
        let finalCol = hasTimeCellStart ? courtIdx : courtIdx - 1;

        const firstCell = firstRow.cells[finalCol];
        if (firstCell) {
            firstCell.style.backgroundColor = hexCode;
            firstCell.classList.add(...'border', 'border-gray-300');
            firstCell.rowSpan = currentY - startY;

            if (bookings[i].booking_type === 'reservation' && showNames) {
                firstCell.classList.add(...'break-words', 'truncate', 'text-xs');
                let name = bookings[i].lastname.length <= 5 ? 
                           bookings[i].lastname : 
                           bookings[i].lastname.slice(0, 5) + ".";
                firstCell.innerText = name + "\n " + bookings[i].firstname.slice(0, 1) + ".";
            }
        }
    }
}

function recreateDayView() {
  const tbody = document.getElementById('dayTimeTableBody');

  for (let stunde = 7; stunde <= 22; stunde++) {
    const tr1 = document.createElement("tr");
    const tr2 = document.createElement("tr");
    tr1.classList.add('h-6');
    tr2.classList.add('h-6');

    let zeitCell = document.createElement("td");
    zeitCell.className = "border-r border-l border-t border-gray-300 p-2 font-medium bg-gray-50";
    zeitCell.textContent = `${String(stunde - 1).padStart(2, "0")}:00`;
    zeitCell.rowSpan = 2;
    tr1.appendChild(zeitCell);

    // Initialisiere leere Zellen für Platz 1 und Platz 2
    for (let i = 0; i < 2; i++) {
      let td1 = document.createElement("td");
      td1.className = "border border-gray-300 p-2 h-6";
      tr1.appendChild(td1);

      let td2 = document.createElement("td");
      td2.className = "border border-gray-300 p-2 h-6";
      tr2.appendChild(td2);
    }

    tbody.appendChild(tr1);
    tbody.appendChild(tr2);
  }
}

  function clearTbody(){
    const tr = document.getElementById('timeTableBody');
    while(tr.firstChild){
      tr.removeChild(tr.firstChild);
    }
  }

  function clearTbodyDayView(){
    const tbody = document.getElementById('dayTimeTableBody');
    while(tbody.firstChild){
      tbody.removeChild(tbody.firstChild);
    }
  }

  function getMondayAndSundayOfKW(kw, year = new Date().getFullYear()) {
      const jan1 = new Date(year, 0, 1);
      const jan1Day = jan1.getDay() || 7;

      const firstMonday = new Date(jan1);
      firstMonday.setDate(jan1.getDate() + (1 - jan1Day));

      const monday = new Date(firstMonday);
      monday.setDate(firstMonday.getDate() + (kw - 1) * 7);

      const sunday = new Date(monday);
      sunday.setDate(monday.getDate() + 6);
      sunday.setHours(23, 59, 0, 0); 

      return { monday, sunday };
  }

  function formatDateSQL(d){
    const date = new Date(d);
    const yyyy = date.getFullYear();
    const mm = date.getMonth();
    const dd = date.getDate();
    return `${yyyy}-${mm}-${dd}`
  }

  function getWeekdayFromDate(d){
    const date = new Date(d);
    const weekday = (date.getDay() == 0)?6 : date.getDay()-1;
    console.log(weekday);
    return weekday;
  }

  function rgbToHex(rgb) {
    // rgb = "rgb(255, 0, 0)"
    const result = rgb.match(/\d+/g);
    if (!result) return null;
    return "#" + result
        .map(x => parseInt(x).toString(16).padStart(2, '0'))
        .join('');
  }

  function setColors(){
    const booking_types = {{{json bookingTypes}}};
    for(let i = 0; i < booking_types.length; i++){
      if(booking_types[i].title == 'reservation'){
        document.getElementById('colorReservation').style.backgroundColor = booking_types[i].hexCode;
      }else if(booking_types[i].title == 'closed'){
        document.getElementById('colorClosure').style.backgroundColor = booking_types[i].hexCode;
      }else if(booking_types[i].title == 'championship'){
        document.getElementById('colorChampionship').style.backgroundColor = booking_types[i].hexCode;
      }
    }
  }
</script>

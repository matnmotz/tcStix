<div class="container mx-auto p-4">
  <!-- Titel -->
    <div class="w-max mx-auto my-5">
        <h1 class="text-[23px]">Tennisplatz</h1>
    </div>

  <!-- Grid Dashboard -->
  <div class="grid gap-6 grid-cols-1 lg:grid-cols-3 lg:grid-rows-2">

    <!-- Buchungsklassen -->
    <div class="bg-gray-100 rounded-xl p-4 shadow hover:shadow-md transition">
      <div class="mb-3">
        <h2 class="text-lg font-bold px-2">Buchungsklassen</h2>
      </div>
      <div class="overflow-x-auto">
        <table class="w-full text-sm text-left">
          <thead class="border-b border-gray-900 rounded-t-xl">
            <tr>
              <th class="px-2 py-1">Bezeichnung</th>
              <th class="px-2 py-1">HEX-Code</th>
              <th class="px-2 py-1">Farbe</th>
            </tr>
          </thead>
          <tbody id="bookingTypeTbody">
            {{#each bookingTypes}}
            <tr class="border-b border-gray-300">
              <td class="px-2 py-1">{{{translateBookingType this.title}}}</td>
              <td class="px-2 py-1">{{this.hexCode}}</td>
              <td class="px-2 py-1">
                <div class="h-5 w-full rounded" style="background-color: {{this.hexCode}};"></div>
              </td>
            </tr>
            {{/each}}
          </tbody>
        </table>
      </div>

      <dialog id="addBookingTypeDialog" class="fixed top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 rounded-xl p-6 shadow-xl backdrop:bg-black/70 bg-white w-[30%]">
        <form action="/user/courtmanagement/bookingType" method="POST">
          <h2 class="text-lg font-bold mb-3">Buchungsklasse bearbeiten</h2>
          <div class="mb-2">
            <table>
              <tr>
                <th class="pr-3">Titel:</th>
                <td id="bookingTypeDialogTitle"></td>
              </tr>
            </table>
            <input type="hidden" name="title" id="bookingTypeDialogTitleIn" />
          </div>
          <div class="mb-2">
            <label class="block mb-1 font-bold">HEX-Code</label>
            <input type="text" placeholder="#FFFFFF" name="hexCode" id="bookingTypeHexCode" class="block w-full rounded p-1 focus:outline-none bg-gray-200"/>
          </div>
          <div class="flex justify-end">
              <button type="button" onclick="document.getElementById('addBookingTypeDialog').close();" class="bg-blue-600 text-white font-medium px-6 py-2 rounded hover:bg-blue-700 transition-colors mr-3 mt-3">Zuück</button>
              <button type="submit" class="bg-blue-600 text-white font-medium px-6 py-2 rounded hover:bg-blue-700 transition-colors mt-3">Speichern</button>
          </div>
        </form>    
      </dialog>
    </div>

    <!-- Aktivitäten -->
    <div class="lg:col-span-2 lg:row-span-2 bg-gray-100 rounded-xl p-4 shadow hover:shadow-md transition">
      <div class="flex justify-between items-center mb-3">
        <h2 class="text-lg font-bold">Aktivitäten</h2>
        <div class="flex items-center space-x-2">
          <button class="py-2 px-3 rounded bg-gray-900 text-white cursor-pointer" onclick="window.location.href='/user/courtmanagement/activity'">Aktivität hinzufügen</button>
          <div class="relative">
            <div class="flex items-center bg-gray-900 text-white py-2 px-3 rounded cursor-pointer" id="activityDrpBtn">
              <span id="activityDrpBtnTxt">2025</span>
              <img src="/media/svg/arrowhead_down.svg" class="h-5 ml-2"/>
            </div>
            <div class="absolute top-full mt-1 w-max bg-gray-900 text-white rounded-b border-t border-white hidden z-10" id="activityDrpChoose">
            </div>
          </div>
          <button class="py-3 px-3 rounded bg-gray-900 text-white cursor-pointer h-full" id="downloadActivitys">
            <img src="/media/svg/download.svg" class="h-[15px]">
          </button>
        </div>
      </div>
      <div class="overflow-x-auto">
        <table class="w-full text-sm text-left">
          <thead class="border-b border-gray-900 rounded-t-xl">
            <tr>
              <th class="px-2 py-1">Titel</th>
              <th class="px-2 py-1">Stunden</th>
              <th class="px-2 py-1 hidden lg:table-cell">Mitglieder</th>
            </tr>
          </thead>
          <tbody id="activityBody"></tbody>
        </table>
      </div>
    </div>

    <!-- Mitgliedsbeitrag -->
    <div class="bg-gray-100 rounded-xl p-4 shadow hover:shadow-md transition">
      <h2 class="text-lg font-bold mb-3">Mitgliedsbeitrag</h2>
      <table class="text-sm">
        <tr>
          <th class="pr-4 text-left">Grundbetrag:</th>
          <td>105€</td>
        </tr>
        <tr>
          <th class="pr-4 text-left py-1">Zahlungsintervall:</th>
          <td>jährlich</td>
        </tr>
      </table>

      <div class="flex items-center mt-3">
        <button class="bg-gray-900 text-white px-3 py-2 rounded flex cursor-pointer" id="downloadMembership"><img src="/media/svg/download.svg" class="h-[20px] mr-2" />Liste herunterladen</button>
        <!-- year selection -->
        <div class="relative">
            <div class="flex items-center bg-gray-900 text-white py-2 px-3 rounded cursor-pointer ml-3" id="membershipDrpBtn">
              <span id="membershipDrpBtnTxt">2025</span>
              <img src="/media/svg/arrowhead_down.svg" class="h-5 ml-2"/>
            </div>
            <div class="absolute top-full mt-1 w-max bg-gray-900 text-white rounded-b border-t border-white hidden z-10 ml-3" id="membershipDrpChoose"></div>
        </div>
      </div>
    </div>
  </div>
</div>

<script>
  fillList();
  elBookingType();
  elActivityBtn();
  elActivityChoose();
  updateActivityTable(new Date().getFullYear());
  elActivity();
  elMembershipBtn();
  elMembershipChoose();

  function elBookingType(){
      const childs = document.getElementById('bookingTypeTbody').children;
      const dialog = document.getElementById('addBookingTypeDialog');
      const title = document.getElementById('bookingTypeDialogTitle');
      const hex = document.getElementById('bookingTypeHexCode');
      for(let i = 0; i < childs.length; i++){
        childs[i].addEventListener('click', (event) => {
          dialog.showModal();
          document.getElementById('bookingTypeDialogTitleIn').value = event.currentTarget.children[0].innerHTML;
          title.innerText = event.currentTarget.children[0].innerHTML;
          hex.value = event.currentTarget.children[1].innerText;
        });
      }
  }

  function elActivityBtn(){
      const btn = document.getElementById('activityDrpBtn');
      const list = document.getElementById('activityDrpChoose');
      btn.addEventListener('click', () => {
          list.classList.toggle('hidden');
      });
  }

  function fillList(){
      const list = document.getElementById('activityDrpChoose');
      let year = new Date().getFullYear();
      document.getElementById('downloadActivitys').onclick = () => {
        window.location.href = "/user/courtmanagement/download-activitys/" + year;
      }
      document.getElementById('downloadMembership').onclick = () => {
        window.location.href = "/user/courtmanagement/download-membership/" + year;
      }
      for(let i = 0; i < 3; i++){
          let div = document.createElement('div');
          div.className = "px-3 py-1 cursor-pointer hover:bg-gray-700";
          div.innerText = year - i;
          list.appendChild(div);
          div = document.createElement('div');
          div.className = "px-3 py-1 cursor-pointer hover:bg-gray-700";
          div.innerText = year - i;
          document.getElementById('membershipDrpChoose').appendChild(div);
      }
  }

  function elMembershipChoose(){
    const childs = document.getElementById('membershipDrpChoose').children;
    const list = document.getElementById('membershipDrpChoose');
    const btnTxt = document.getElementById('membershipDrpBtnTxt');
    for(let i = 0; i < childs.length; i++){
      childs[i].addEventListener('click', (event) => {
        btnTxt.innerText = event.target.innerText;
        document.getElementById('downloadMembership').onclick = () => {
          window.location.href = "/user/courtmanagement/download-membership/" + event.target.innerText;
        }
        list.classList.add('hidden');
      });
    }
  }
  function elMembershipBtn(){
    const btn = document.getElementById('membershipDrpBtn');
    const list = document.getElementById('membershipDrpChoose');
    btn.addEventListener('click', (event) => {
      if(list.classList.contains('hidden')){
        list.classList.remove('hidden');
      }else{
        list.classList.add('hidden');
      }
    })
  }

  function elActivityChoose(){
      const childs = document.getElementById('activityDrpChoose').children;
      const list = document.getElementById('activityDrpChoose');
      const btnTxt = document.getElementById('activityDrpBtnTxt');
      for(let i = 0; i < childs.length; i++){
          childs[i].addEventListener('click', (event) => {
              btnTxt.innerText = event.target.innerText;
              updateActivityTable(parseInt(event.target.innerText));
              document.getElementById('downloadActivitys').onclick = () => {
                window.location.href = "/user/courtmanagement/download-activitys/" + event.target.innerText;
              }
              list.classList.add('hidden');
              elActivity();
          });
      }
  }

  function updateActivityTable(year){
      clearTbody();
      const tbody = document.querySelector('#activityBody');
      const activitys = {{{json activitys}}};
      activitys.forEach(act => {
          if(act.year == year){
              const tr = document.createElement('tr');
              tr.classList.add(..."border-b border-gray-300".split(" "));
              tr.innerHTML = `
                <td class='hidden'>${act.activityID}</td>
                <td class="px-2 py-1">${act.title}</td>
                <td class="px-2 py-1">${act.time}</td>
                <td class="px-2 py-2 hidden lg:table-cell">
                  ${act.firstMember}${act.otherMembers > 0 ? `, +${act.otherMembers} ${act.otherMembers == 1 ? "Mitglied" : "Mitglieder"}` : ""}
                </td>
              `;
              tbody.appendChild(tr);
          }
      });
  }

  function elActivity(){
      const tbody = document.getElementById('activityBody');
      const childs = tbody.children;
      for(let i = 0; i < childs.length; i++){
        childs[i].addEventListener('click', (event) => {
          window.location.href = '/user/courtmanagement/activity/' + event.currentTarget.children[0].innerText;
        })
      }
  }

  function clearTbody(){
      const tbody = document.querySelector('#activityBody');
      tbody.innerHTML = "";
  }
</script>

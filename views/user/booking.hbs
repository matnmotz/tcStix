<div class="max-w-xl mx-auto bg-white rounded-2xl shadow-lg border border-gray-100 p-8 mt-12 mb-12">
    
    <!-- Titel -->
    <h2 class="text-2xl font-semibold text-gray-800 mb-6 text-center">
        Neue Reservierung
    </h2>

    <form action="#" method="POST" class="space-y-5">
        <!-- datum -->
        <div>
            <label class="block text-sm font-medium text-gray-700 mb-1">Datum</label>
            <input 
                type="date" 
                name="date" 
                class="w-full rounded-lg border border-gray-300 p-2.5 focus:outline-none focus:ring-2 focus:ring-cyan-500 transition"
                id="date"
            />
        </div>
        <!-- Von -->
        <div>
            <label class="block text-sm font-medium text-gray-700 mb-1">Von</label>
            <input 
                type="time" 
                name="from" 
                class="w-full rounded-lg border border-gray-300 p-2.5 focus:outline-none focus:ring-2 focus:ring-cyan-500 transition"
                id="from"
            />
        </div>

        <!-- Bis -->
        <div>
            <label class="block text-sm font-medium text-gray-700 mb-1">Bis</label>
            <input 
                type="time" 
                name="to" 
                class="w-full rounded-lg border border-gray-300 p-2.5 focus:outline-none focus:ring-2 focus:ring-cyan-500 transition"
                id="to"
            />
        </div>

        <!-- Tennisplatz -->
        <div>
            <label class="block text-sm font-medium text-gray-700 mb-1">Tennisplatz</label>
            <select 
                name="court"
                class="w-full rounded-lg border border-gray-300 p-2.5 bg-white focus:outline-none focus:ring-2 focus:ring-cyan-500 transition"
            >
            {{#each courts}}
                <option value="{{this.courtID}}">{{this.title}}</option>
            {{/each}}
            </select>
        </div>

        <!-- Mitspieler -->
        <div>
            <label class="block text-sm font-medium text-gray-700 mb-1">Mitspieler</label>
            <select 
                name="partner"
                class="w-full rounded-lg border border-gray-300 p-2.5 bg-white focus:outline-none focus:ring-2 focus:ring-cyan-500 transition"
            >
                    <option value="-1">Keinen Mitspieler</option>
                {{#each users}}
                    <option value="{{this.userID}}">{{this.lastname}} {{this.firstname}}</option>
                {{/each}}
            </select>
        </div>

        <!-- Button -->
        <div class="pt-4 flex justify-end">
            <button 
                type="submit"
                class="bg-cyan-600 hover:bg-cyan-700 text-white font-medium px-6 py-2.5 rounded-lg shadow transition"
            >
                Reservierung speichern
            </button>
        </div>

    </form>
</div>

<script>
    setTodaysDate();
    elTime();

    function setTodaysDate(){
        const today = new Date();
        document.getElementById('from').value = "08:00";
        document.getElementById('to').value = "09:00";
        document.getElementById('date').value = formatDate(today);
        document.getElementById('date').min = formatDate(today);
        document.getElementById('date').max = formatDate(getSundayInThreeWeeks());

    }

    function formatDate(date){
        const dd = String(date.getDate()).padStart(2, '0');
        const mm = String(date.getMonth() + 1).padStart(2, '0');
        const yy = date.getFullYear();

        return `${yy}-${mm}-${dd}`;
    }

    function getSundayInThreeWeeks() {
        const today = new Date();
        const dayOfWeek = today.getDay();
        const daysUntilSunday = (7 - dayOfWeek) % 7 || 7;
        const targetDate = new Date(today);
        targetDate.setDate(today.getDate() + daysUntilSunday + 14);
        return targetDate;
    }

    function elTime(){
        const from = document.querySelector('#from');
        const to = document.querySelector('#to');
        from.addEventListener('input', (event) => {
            from.value = validateTime(from.value);
            to.value = autoAdaptTime(from.value,to.value);
        })
        to.addEventListener('input', (event) => {
            to.value = validateTime(to.value);
            to.value = autoAdaptTime(from.value,to.value);
        })
    }

    function validateTime(t, type){
        const minTime = 6;
        const maxTime = 22;
        
        let hour = parseInt(t.substring(0,2));
        const min = parseInt(t.substring(3,5));

        if(hour >= minTime && hour <= maxTime){
            hour = String(hour).padStart(2,"0");
            if(min < 30){
                //unter 30min ausgew채hlt
                return (min < 15) ? `${hour}:00` : `${hour}:30`;
            }else{
                //체ber 30min ausgew채hlt
                return (min < 45) ? `${hour}:30` : `${hour+1}:00`;
            }
        }else if(hour < minTime){
            // unter 6 Uhr
            return (type == 'from')? '06:00' : '07:00';
        }else if(hour > maxTime){
            // 체ber 22Uhr
            return (type == 'from')? '21:00' : '22:00';
        }
    }

    function autoAdaptTime(from, to){
        const fh = parseInt(from.substring(0,2));
        const fm = parseInt(from.substring(3,5));
        const th = parseInt(to.substring(0,2));
        const tm = parseInt(to.substring(3,5));
        if((th-fh < 1 || (th-fh == 1 && fm != tm)) && th <= 22){
            const hour = String(parseInt(from.substring(0,2)) + 1).padStart(2,"0");
            const min = from.substring(3,5).padStart(2,"0");
            return `${hour}:${min}`;
        }else{
            return to;
        }
    }


</script>
